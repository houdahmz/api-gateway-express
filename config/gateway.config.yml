http:
  port: ${HTTP_PORT:-8080}

admin: 
  port: ${HTTP_PORT_ADMIN:-9876}
  host: localhost 

apiEndpoints:
  topup:
    host: localhost
    paths: /api/facial
    methods:
      - POST
      
  profile:
    - host: localhost
      paths: /admin/company*
      methods: ["POST","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/profile*
      methods: ["DELETE","GET"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/profile/by_userId/:id
      methods: ["GET"]
      scopes: ['user']

    - host: localhost
      paths: /user-management/profile*
      methods: ["PUT","PATCH"]
      scopes: ['user']

    - host: localhost
      paths: /user-management/company/:id
      methods: ["PUT","PATCH"]
      scopes: ['user']

    - host: localhost
      paths: /user-management/company/profile-by-company
      methods: ["POST"]
      scopes: ['user']

    - host: localhost
      paths: /user-management/history/*
      methods: ["GET"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/image*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/activity*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/type_user/by_code/:id
      methods: ["GET"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/type-user*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/category*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/document*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/company*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: /user-management/activity-company*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

  voucher:
# add voucher 
    - host: localhost
      paths: /voucher*
      methods: ["GET","POST","DELETE"]
      scopes: ['admin']

# valider les vouchers importer et modifier leurs status
    - host: localhost
      paths: /voucher/document*
      methods: ["DELETE","GET","PUT"]
      scopes: ['admin']

    - host: localhost
      paths: '/voucher/transaction'
      methods: ["POST"]
      scopes: ['admin']

    - host: localhost
      paths: '/voucher/transaction'
      methods: ["GET"]
      scopes: ['admin']

    - host: localhost
      paths: '/voucher/transaction/by_user/:id'
      methods: ["GET"]
      scopes: ['user']
# valider et refuser les commandes
    - host: localhost
      paths: '/voucher/transaction/status/:id'
      methods: ["PUT"]
      scopes: ['admin']

    - host: localhost
      paths: /voucher/facial*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    # - host: localhost
    #   paths: /voucher/voucher*
    #   methods: ["POST"]
    #   scopes: ['admin']

    - host: localhost
      paths: /voucher/operator*
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    - host: localhost
      paths: '/voucher/settings*'
      methods: ["GET","POST","DELETE","PUT","PATCH"]
      scopes: ['admin']

    # - host: localhost
    #   paths: /voucher/transaction/
    #   methods: ["GET"]
    #   scopes: ['admin']

  paymee:
    - host: localhost
      paths: /paymee/cashin
      methods: ["POST"]
      scopes: ['user']

    - host: localhost
      paths:  ['/paymee/accountname/:id']
      methods: ["GET"]
      scopes: ['user']

    - host: localhost
      paths: /paymee/transactions
      scopes: ['admin']
  
  poste:
    - host: localhost
      paths: /poste/affiliation
      methods: ["POST"]
      scopes: ['user']

    - host: localhost
      paths: /poste/bill-payment
      methods: ["POST"]
      scopes: ['user']

    - host: localhost
      paths: /poste/recharge-card
      methods: ["POST"]
      scopes: ['user']

    - host: localhost
      paths: /poste/balance
      methods: ["POST"]
      scopes: ['admin']

    - host: localhost
      paths: /poste/unsubscribe*
      methods: ["POST"]
      scopes: ['user']

    - host: localhost
      paths: /poste/affiliation*
      methods: ["GET"]
      scopes: ['admin']
    - host: localhost
      paths: /poste/affiliation/user*
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /poste/recharge*
      methods: ["GET"]
      scopes: ['admin']
    - host: localhost
      paths: /poste/recharge/user*
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /poste/bill-payment*
      methods: ["GET"]
      scopes: ['admin']  
    - host: localhost
      paths: /poste/bill-payment/user*
      methods: ["GET"]
      scopes: ['user']  
    - host: localhost
      paths: /poste/transaction*
      methods: ["GET"]
      scopes: ['admin'] 
  topnet:
    - host: localhost
      paths: /topnet/payment*
      methods: ["POST"]
      scopes: ['user']

    - host: localhost
      paths:  /topnet/transaction/user*
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths:  /topnet/transaction*
      methods: ["GET"]
      scopes: ['admin']
    - host: localhost
      paths: /topnet/bill*
      methods: ["GET"]
      scopes: ['user']
  
  agent-register:
    - host: localhost
      paths: /api/agent-register/profile/agent
      methods: ["POST"]
      scopes: ['agent']
  wallet:
    - host: localhost
      paths: /wallet/supplier-service
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/supplier-service*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/supplier-service*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/supplier-service/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/supplier-service/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/supplier
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/supplier
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/supplier*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/supplier*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/supplier/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/supplier/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/supplier
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/reimbursed
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/reimbursed
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/reimbursed*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/reimbursed*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/reimbursed/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/reimbursed/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/reimbursed
      methods: ["POST"]
      scopes: ['user']  
    - host: localhost
      paths: /wallet/service
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/service
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/service*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/service*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/service/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/service/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/service
      methods: ["POST"]
      scopes: ['user']    
    - host: localhost
      paths: /wallet/category
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/category
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/category*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/category*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/category/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/category/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/category  
    - host: localhost
      paths: /wallet/document
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/document
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/document*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/document*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/document/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/document/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/document     
    - host: localhost
      paths: /wallet/currency
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/currency
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/currency*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/currency*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/currency/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/currency/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/currency   
    - host: localhost
      paths: /wallet/feed
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/feed
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/feed*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/feed*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/feed/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/feed/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/feed   
    - host: localhost
      paths: /wallet/intervenant
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/intervenant
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/intervenant*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/intervenant*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/intervenant/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/intervenant/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/intervenant  
    - host: localhost
      paths: /wallet/commission
      methods: ["POST"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/commission
      methods: ["GET"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/commission*
      methods: ["GET"]
      scopes: ['user']   
    - host: localhost
      paths: /wallet/commission*
      methods: ["PUT"]
      scopes: ['user']
    - host: localhost
      paths: /wallet/commission/*
      methods: ["PATCH"]
      scopes: ['user'] 
    - host: localhost
      paths: /wallet/commission/*
      methods: ["DELETE"]
      scopes: ['user']                       
    - host: localhost
      paths: /wallet/commission  
    - host: localhost
      paths: /wallet
      methods: ["GET"]
      scopes: ['admin']    
    - host: localhost
      paths: /wallet/history
      methods: ["GET"]
      scopes: ['admin']       
                                  
  api:
    host: '*'
    paths: ['/users*','/scopes*','/credentials*','/apps*']
    methods: ["GET","POST","PUT","DELETE","PATCH",PUT]
    scopes: ['super_admin']

serviceEndpoints:
  api_management:
    url: http://localhost:${HTTP_PORT_API_MANAGEMENT:-5008}/api-management
  backend:
    url: http://localhost:${HTTP_PORT_ADMIN:-9876}

policies:
  - basic-auth
  - key-auth
  - log
  - proxy
  - oauth2
  - jwt
  - request-transformer
  - validate-user
  - jwt-permissions
  - jwtScopes
  - agent-register
  - rewrite
  - tokenReg
  - login
  - response-transformer
  - cors

pipelines:
  # default:
  #   apiEndpoints:
  #     - profile
  #   policies:
  #     - log:
  #         - action:
  #             message: "profile eee header===> ${req.headers.authorization} ---${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
  #   # rewrite:
  #   #   -
  #   #     condition:
  #   #       name: pathmatch
  #   #       match: /:route*
  #   #     action:
  #   #       rewrite: /api_management/:route
  #     - log:
  #         - action:
  #             message: "eeerrr header===> ${req.headers.authorization} ---${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
  #     - oauth2:
  #         - action:
  #             jwt:
  #               issuer: express-gateway
  #               audience: something
  #               subject: 3pXQjeklS3cFf8OCJw9B22
  #               secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
  #               checkCredentialExistence: false
  #     - validate-user:
  #     - request-transformer:
  #         action:
  #           body:
  #             add:
  #               user: req.user
  #     - log:
  #         - action:
  #             message: "aaaa ${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"

  #     - proxy:
  #         - action:
  #             serviceEndpoint: api_management
  #             changeOrigin: true
  voucher:
    apiEndpoints:
      - voucher
    policies:
      - log:
          - action:
              message: "voucher header===> ${req.headers.authorization} ---${req.originalUrl}  ${req.url}"
      - cors:    
      - oauth2:
          - action:
              jwt:
                issuer: express-gateway
                audience: something
                subject: 3pXQjeklS3cFf8OCJw9B22
                secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
                checkCredentialExistence: false
      - validate-user:
      - request-transformer:
          action:
            body:
              add:
                user: req.user
      - log:
          - action:
              message: "${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
      - proxy:
          - action:
              serviceEndpoint: api_management
              changeOrigin: true

  profile:
    apiEndpoints:
      - profile
    policies:
      - log:
          - action:
              message: "profile header===> ${req.headers.authorization} ---${req}"
      - cors:
      - oauth2:
          - action:
              jwt:
                issuer: express-gateway
                audience: something
                subject: 3pXQjeklS3cFf8OCJw9B22
                secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
                checkCredentialExistence: false
      - validate-user:
      - request-transformer:
          action:
            body:
              add:
                user: req.user
      - log:
          - action:
              message: "${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
      - proxy:
          - action:
              serviceEndpoint: api_management
              changeOrigin: true

  topup:
    apiEndpoints:
      - topup
    policies:
      - proxy:
          - action:
              serviceEndpoint: api_management
              changeOrigin: true

  paymee:
    apiEndpoints:
      - paymee
    policies:
      - log:
          - action:
              message: "paymee header===> ${req.headers.authorization} ---${req.originalUrl}  ${req.url}"
      - cors:
      - oauth2:
          - action:
              jwt:
                issuer: express-gateway
                audience: something
                subject: 3pXQjeklS3cFf8OCJw9B22
                secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
                checkCredentialExistence: false
      - validate-user:
      - request-transformer:
          action:
            body:
              add:
                user: req.user
      - log:
          - action:
              message: "${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"

      - proxy:
          - action:
              serviceEndpoint: api_management
              changeOrigin: true

  adminAPI:
    apiEndpoints:
      - api
    policies:
      - log:
          - action:
              message: "api admin header===> ${req.headers.authorization} ${req.originalUrl}  ${req.url}"
      - cors:              
      - oauth2:
          - action:
              jwt:
                issuer: express-gateway
                audience: something
                subject: 3pXQjeklS3cFf8OCJw9B22
                secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
                checkCredentialExistence: false
      - validate-user:
      - request-transformer:
          action:
            body:
              add:
                user: req.user
      - log:
          - action:
              message: "${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
      - proxy:
          - action:
              serviceEndpoint: backend
              changeOrigin: true

  poste:
    apiEndpoints:
      - poste
    policies:
      - log:
          - action:
              message: "header===> ${req.headers.authorization} ---${req}"
      - cors:
      - oauth2:
          - action:
              jwt:
                issuer: express-gateway
                audience: something
                subject: 3pXQjeklS3cFf8OCJw9B22
                secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
                checkCredentialExistence: false
      - validate-user:
      - request-transformer:
          action:
            body:
              add:
                user: req.user
      - log:
          - action:
              message: "${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
      - proxy:
          - action:
              serviceEndpoint: api_management
              changeOrigin: true

  topnet:
    apiEndpoints:
      - topnet
    policies:
      - log:
          - action:
              message: "topnet header===> ${req.headers.authorization} ---${req}"
      - cors:
      - oauth2:
          - action:
              jwt:
                issuer: express-gateway
                audience: something
                subject: 3pXQjeklS3cFf8OCJw9B22
                secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
                checkCredentialExistence: false
      - validate-user:
      - request-transformer:
          action:
            body:
              add:
                user: req.user
      - log:
          - action:
              message: "${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
      - proxy:
          - action:
              serviceEndpoint: api_management
              changeOrigin: true
  wallet:
    apiEndpoints:
      - wallet
    policies:
      - log:
          - action:
              message: "wallet header===> ${req.headers.authorization} ---${req}"
      - cors:
      - oauth2:
          - action:
              jwt:
                issuer: express-gateway
                audience: something
                subject: 3pXQjeklS3cFf8OCJw9B22
                secretOrPublicKey: 54v3WJGBcFPh3TFgZSzovw
                checkCredentialExistence: false
      - validate-user:
      - request-transformer:
          action:
            body:
              add:
                user: req.user
      - log:
          - action:
              message: "${res.statusCode}-${req.method} ${req.originalUrl}  ${req.url}"
      - proxy:
          - action:
              serviceEndpoint: api_management
              changeOrigin: true



